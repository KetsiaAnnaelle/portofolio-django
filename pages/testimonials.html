<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Témoignages | Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../assets/css/dashboard-theme.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.min.css">
</head>
<body>
  <aside class="dashboard-sidebar">
    <div class="profile">
      <img src="https://via.placeholder.com/80" alt="Profile">
      <h3>Ketsia</h3>
      <p>User</p>
    </div>
    <nav>
      <a href="dashboard.html"><i class="fas fa-th-large"></i>Dashboard</a>
      <a href="about.html"><i class="fas fa-user"></i>About</a>
      <a href="skills.html"><i class="fas fa-code"></i>Skills</a>
      <a href="qualifications.html"><i class="fas fa-graduation-cap"></i>Qualifications</a>
      <a href="services.html"><i class="fas fa-briefcase"></i>Services</a>
      <a href="portfolio.html"><i class="fas fa-folder-open"></i>Portfolio</a>
      <a href="testimonials.html" class="active"><i class="fas fa-comments"></i>Testimonial</a>
      <a href="contact.html"><i class="fas fa-envelope"></i>Contact</a>
    </nav>
  </aside>
  <main class="dashboard-main">
    <div class="dashboard-card">
      <div class="dashboard-title">Témoignages</div>
      <div class="dashboard-desc">Ajoutez ou modifiez les témoignages de vos clients pour les afficher sur votre site public.</div>
      <form id="testimonialsForm">
        <input type="text" name="author" placeholder="Auteur" required>
        <textarea name="testimonial" placeholder="Témoignage" required></textarea>
      <button type="submit">Ajouter</button>
        <div id="form-status"></div>
    </form>
    </div>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.all.min.js"></script>
  <script>
    document.getElementById('testimonialsForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = e.target;
      const author = form.author.value.trim();
      const testimonial = form.testimonial.value.trim();
      // Client-side validation
      if (!author || !testimonial) {
        Swal.fire({ icon: 'error', title: 'Erreur', text: 'Tous les champs sont obligatoires.' });
        return;
      }
      if (author.length < 2) {
        Swal.fire({ icon: 'error', title: 'Erreur', text: "Le nom de l'auteur doit contenir au moins 2 caractères." });
        return;
      }
      if (testimonial.length < 10) {
        Swal.fire({ icon: 'error', title: 'Erreur', text: 'Le témoignage doit contenir au moins 10 caractères.' });
        return;
      }
      const formData = new FormData(form);
      const statusDiv = document.getElementById('form-status');
      statusDiv.innerHTML = '';
      try {
        const response = await fetch('http://127.0.0.1:8000/api/testimonials/', {
          method: 'POST',
          body: formData,
        });
        const data = await response.json();
        if (data.success) {
          await Swal.fire({
            icon: 'success',
            title: 'Témoignage ajouté !',
            confirmButtonText: 'OK',
          });
          statusDiv.innerHTML = '<span style="color:green;">Témoignage ajouté !</span>';
          form.reset();
        } else if (data.errors) {
          let errorList = '<ul class="form-error-list">';
          for (const [field, errors] of Object.entries(data.errors)) {
            errors.forEach(error => {
              errorList += `<li><strong>${field}:</strong> ${error}</li>`;
            });
          }
          errorList += '</ul>';
          statusDiv.innerHTML = errorList;
          Swal.fire({
            icon: 'error',
            title: 'Erreur',
            html: errorList,
            confirmButtonText: 'OK',
          });
        }
      } catch (err) {
        statusDiv.innerHTML = '<p style="color:red;">Erreur lors de la soumission du formulaire.</p>';
        Swal.fire({
          icon: 'error',
          title: 'Erreur',
          text: 'Erreur lors de la soumission du formulaire.',
          confirmButtonText: 'OK',
        });
      }
    });
  </script>
</body>
</html>
