<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>À propos | Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../assets/css/dashboard-theme.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.min.css">
</head>
<body>
  <aside class="dashboard-sidebar">
    <div class="profile">
      <img src="https://via.placeholder.com/80" alt="Profile">
      <h3>Ketsia</h3>
      <p>User</p>
    </div>
    <nav>
      <a href="dashboard.html"><i class="fas fa-th-large"></i>Dashboard</a>
      <a href="about.html" class="active"><i class="fas fa-user"></i>About</a>
      <a href="skills.html"><i class="fas fa-code"></i>Skills</a>
      <a href="qualifications.html"><i class="fas fa-graduation-cap"></i>Qualifications</a>
      <a href="services.html"><i class="fas fa-briefcase"></i>Services</a>
      <a href="portfolio.html"><i class="fas fa-folder-open"></i>Portfolio</a>
      <a href="testimonials.html"><i class="fas fa-comments"></i>Testimonial</a>
      <a href="contact.html"><i class="fas fa-envelope"></i>Contact</a>
    </nav>
  </aside>
  <main class="dashboard-main">
    <div class="dashboard-card">
      <div class="dashboard-title">À propos de moi</div>
      <div class="dashboard-desc">Modifiez les informations de votre profil pour les afficher sur votre site public.</div>
      <form id="aboutForm" enctype="multipart/form-data">
        <textarea name="bio" placeholder="Votre biographie" required></textarea>
        <div class="input-error" id="error-bio">Photo</div>
        <input type="file" name="photo" accept="image/*">
        <div class="input-error" id="error-photo">CV</div>
        <input type="file" name="cv" accept=".pdf,.doc,.docx">
        <div class="input-error" id="error-cv"></div>
        <button type="submit">Enregistrer</button>
        <div id="form-status"></div>
      </form>
    </div>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.12/dist/sweetalert2.all.min.js"></script>
  <script>
    document.getElementById('aboutForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      // Clear all per-field errors
      ['bio', 'photo', 'cv'].forEach(field => {
        document.getElementById('error-' + field).textContent = '';
      });
      const form = e.target;
      const bio = form.bio.value.trim();
      let hasError = false;
      // Client-side validation
      if (!bio) {
        document.getElementById('error-bio').textContent = "La biographie est obligatoire.";
        hasError = true;
      } else if (bio.length < 10) {
        document.getElementById('error-bio').textContent = "La biographie doit contenir au moins 10 caractères.";
        hasError = true;
      }
      if (hasError) return;
      const formData = new FormData(form);
      const statusDiv = document.getElementById('form-status');
      statusDiv.innerHTML = '';
      try {
        const response = await fetch('http://127.0.0.1:8000/api/about/', {
          method: 'POST',
          body: formData,
        });
        const data = await response.json();
        if (data.success) {
          await Swal.fire({
            icon: 'success',
            title: 'Profil mis à jour !',
            confirmButtonText: 'OK',
          });
          statusDiv.innerHTML = '<span style="color:green;">Profil mis à jour !</span>';
          form.reset();
        } else if (data.errors) {
          // Show server-side errors under each field if possible
          for (const [field, errors] of Object.entries(data.errors)) {
            const errorDiv = document.getElementById('error-' + field);
            if (errorDiv) {
              errorDiv.textContent = errors.join(', ');
            }
          }
          // Also show SweetAlert for global/server errors
          let errorList = '<ul class="form-error-list">';
          for (const [field, errors] of Object.entries(data.errors)) {
            errors.forEach(error => {
              errorList += `<li><strong>${field}:</strong> ${error}</li>`;
            });
          }
          errorList += '</ul>';
          statusDiv.innerHTML = errorList;
          Swal.fire({
            icon: 'error',
            title: 'Erreur',
            html: errorList,
            confirmButtonText: 'OK',
          });
        }
      } catch (err) {
        statusDiv.innerHTML = '<p style="color:red;">Erreur lors de la soumission du formulaire.</p>';
        Swal.fire({
          icon: 'error',
          title: 'Erreur',
          text: 'Erreur lors de la soumission du formulaire.',
          confirmButtonText: 'OK',
        });
      }
    });
  </script>
</body>
</html>
